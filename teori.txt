-- Pengenalan Database Migration
        1. Saat ini, kebanyakan aplikasi yang dibuat akan membutuhkan database
        2. Saat aplikasi berjalan, biasanya database sudah siap digunakan, artinya table, kolom dan semua relasinya
           sudah dibuat di awal sebelum aplikasi dijalankan
        3. Apa yang terjadi ketika misal pada saat aplikasi sudah berjalan, kita perlu menambah fitur baru, lalu butuh
           mengubah struktur table di database?
        4. Biasanya kita akan mengubahnya di database langsung, lalu melakukan perubahan kode program
        5. Hal ini mungkin terlihat sederhana, namun ketika skalanya sudah besar, dan anggota tim sudah banyak,
           maka perubahan langsung ke database bukanlah hal sederhana lagi
        6. Kita harus bisa melakukan tracking apa saja yang berubah, dan memastikan semua anggota tim tahu perubahannya,
           sehingga bisa dilakukan hal yang sama di komputer masing-masing

        -- Keuntungan Database Migration
                1. Oleh karena itu, Database Migration sangat diperlukan
                2. Database Migration adalah mekanisme untuk melakukan tracking perubahan struktur database, dari mulai
                   awal dibuat sampai perubahan terakhir yang dilakukan
                3. Mirip seperti Git, dimana melakukan tracking semua perubahan kode program
                4. Dengan menggunakan Database Migration, semua tim member bisa melihat perubahan struktur database,
                   dan bisa dengan mudah menjalankan perubahan tersebut di tiap komputer masing-masing
                5. Selain itu, dengan adanya Database Migration, kita bisa melakukan review terlebih dahulu,
                   sebelum menjalankan perubahan di database, jaga-jaga ada perubahan yang salah,
                   yang bisa berdampak berbahaya ke database

-- Pengenalan Golang Migrate
        1. Golang Migrate adalah salah satu tool untuk Database Migration yang populer digunakan oleh programmer Golang
        2. Golang Migrate bisa diintegrasikan dengan aplikasi, atau dijalankan sebagai aplikasi standalone
        3. Golang Migrate mendukung banyak sekali database, seperti MySQL, PostgreSQL, Sqlite, MongoDB, Cassandra, dan lain-lain
        4. https://github.com/golang-migrate/migrate

        --Menginstall Golang Migrate
                1. Untuk menginstall Golang Migrate, sangat mudah, kita bisa gunakan perintah berikut :
                        go install -tags â€˜database1,database2â€™ github.com/golang-migrate/migrate/v4/cmd/migrate@latest
                2. Sesuaikan dengan database yang ingin kita gunakan, bisa lebih dari satu dengan cara menambahkan koma

        -- Aplikasi migrate
                1. Saat menginstall Golang Migrate, secara otomatis terdapat executable file di folder $GOPATH/bin/ dengan nama migrate
                2. File migrate tersebut adalah aplikasi Golang Migrate yang akan kita gunakan untuk membuat Database Migration

-- Membuat Database Migration
        1. Untuk membuat database migration, kita bisa gunakan perintah :
                migrate create -ext sql -dir db/migrations nama_file_migration
                       -ext adalah file extension, artinya kita membuat file .sql
                       -dir adalah folder tempat disimpan
        2. Usahakan tidak menggunakan spasi pada nama file migration

        -- File Migration
                1. File migration akan diawali dengan waktu ketika kita membuat file migration, lalu diikuti dengan nama migration,
                   dan diakhiri dengan tipe migration misal 20220921103313_create_table_category.up.sql
                3. Kenapa diawali dengan waktu? Agar file migration selalu berurut sesuai waktu kita membuat file migration tersebut

-- Migration Up
        1. Saat kita membuat file database migration, file dengan akhiran up adalah file yang harus kita isi dengan perubahan yang ingin kita tambahkan
        2. Misal, sekarang kita akan tambahkan table category, sesuai dengan aplikasi RESTful API yang sudah kita buat

-- Migration Down
        1. Setiap file migration, selain file up, terdapat juga file down
        2. File down ini adalah file yang berisikan kode untuk mengembalikan perubahan yang kita lakukan di file up
        3. Kenapa ini diperlukan? Karena misal terjadi masalah di aplikasi, namun database migration terlanjur dijalankan,
           kita bisa melakukan rollback dengan cara menjalankan file down, karena berisikan kode untuk mengembalikan perubahan di file up
        4. Pada kasus ini, misal kita akan menghapus lagi table category

-- Membuat Database
        1. Sebelum menjalankan Database Migration, sekarang kita perlu membuat dulu database nya
        2. Hal ini karena pembuatan database tidak dilakukan di database migration, biasanya dilakukan manual diawal
        3. Pada kasus ini, kita menggunakan database mysql, dan kita perlu ubah juga kode koneksi database di aplikasi
           agar terhubung dengan database baru

-- Menjalankan Migration
        1. Selanjutnya, setelah selesai, kita bisa menjalan database migration menggunakan perintah :
            migrate -database "koneksidatabase" -path folder up angka
                -database harus berisikan koneksi database,
                    misal untuk mysql, bisa menggunakan : mysql://user:password@tcp(host:port)/nama_database
                    Untuk database lainnya, bisa lihat di halaman dokumentasinya : https://github.com/golang-migrate/migrate#databases
                -path adalah lokasi folder file database migration
                up adalah perintah untuk menjalankan database migration dengan mode up
                angka itu adalah nilai angka jumlah migrasi yang ingin dijalankan jika tidak ingin migrasi semua (opsional)

-- Migration State
        1. Saat kita sudah melakukan migration, lalu kita menambah file migration baru, apa yang terjadi jika kita menjalankan migration lagi?
        2. Golang Migrate akan menyimpan state terakhir kita menjalankan database migration, artinya tidak akan dijalankan dari awal lagi,
           melainkan dari file terakhir yang sukses di migrasi
        3. Jadi kita tidak perlu takut file akan dijalankan lagi, jadi tidak perlu dihapus file migration lama-nya
        4. Semua informasi state tersebut disimpan dalam table schema_migrations

-- Rollback Migration
        1. Pada waktu misal terjadi masalah pada aplikasi, yang menyebabkan kita harus melakukan rollback perubahan, apa yang kita harus lakukan?
        2. Fitur itu sudah ada di Golang Migrate, jadi kita bisa menjalankan mode down untuk melakukan rollback dengan perintah :
                    migrate -database "koneksidatabase" -path folder down angka

-- Migrasi ke Versi Tertentu
        1. Saat menggunakan mode up atau down, secara otomatis akan melakukan migrasi seluruh file
        2. Kadang pada kenyataanya, kita mungkin hanya ingin melakukan up atau down ke versi tertentu saja
        3. Misal jika ingin melakukan rollback, mungkin kita hanya ingin rollback satu versi saja, tidak mau melakukan rollback semua versi
        4. Untuk kasus ini, setelah perintah up atau down, kita bisa memasukkan angka, yaitu jumlah migration yang ingin kita eksekusi

-- Dirty State
        1. Saat kita membuat database migration, kadang kesalahan sering terjadi
        2. Misal saja, kita melakukan typo sehingga membuat perintah SQL nya salah
        3. Jika kita terlanjur menjalankan database migration, maka state akan berubah menjadi Dirty State
        4. State gimana kita tidak bisa melakukan up atau down lagi
        5. Pada kasus ini, kita harus perbaiki manual, kenapa harus manual? Karena tidak ada cara otomatis memperbaikinya

        -- Permasalahan
                1. Permasalahan migration ini adalah, kita membuat dua table di file migration,
                   pada pembuatan table pertama sukses, namun pada table kedua gagal
                2. Artinya file migration tidak sempurna, dan kita juga tidak bisa melakukan rollback,
                   karena table kedua belum sukses dibuat
                3. Pada kondisi ini, terjadi yang namanya Dirty State, dimana kita tidak bisa melakukan up atau down,
                   yang perlu kita lakukan adalah memperbaiki secara manual

        -- Mengubah Versi
                1. Setelah kita memperbaiki secara manual, selanjutnya kita perlu mengubah versi migration di table schema_migrations
                2. Kita bisa lakukan manual, atau bisa otomatis menggunakan perintah :
                            migrate -database "koneksi_database" -path folder force versi
                3. Dimana versi adalah versi dari file database migration
                4. Pada kasus ini, kita akan gunakan satu versi sebelum migration yang gagal
